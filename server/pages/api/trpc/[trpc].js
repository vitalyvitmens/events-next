"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},272:e=>{e.exports=import("@trpc/client")},7455:e=>{e.exports=import("@trpc/next")},4936:e=>{e.exports=import("@trpc/next/ssrPrepass")},2937:e=>{e.exports=import("@trpc/server")},6282:e=>{e.exports=import("@trpc/server/adapters/next")},3020:e=>{e.exports=import("superjson")},9926:e=>{e.exports=import("zod")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6816:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>p,routeModule:()=>u});var i=r(1802),n=r(7153),s=r(6249),o=r(6433),d=e([o]);o=(d.then?(await d)():d)[0];let p=(0,s.l)(o,"default"),c=(0,s.l)(o,"config"),u=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/trpc/[trpc]",pathname:"/api/trpc/[trpc]",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},4455:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>p,default:()=>c});var a=r(8432),i=r.n(a),n=r(2357),s=r(3227),o=r.n(s);let d=require("next-auth/providers/credentials"),p={providers:[r.n(d)()({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e,t){if(!e)return null;let r=await n.prisma.user.findUnique({where:{email:e.email}});return r&&await i().compare(e.password,r.password)?r:null}})],callbacks:{session:({session:e,token:t})=>(e.user.id=Number(t.sub),e),redirect:async({url:e,baseUrl:t})=>e.startsWith(t)?t:t+"/auth/signin"}},c=o()(p)},6433:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>d});var i=r(2688),n=r(9326),s=r(6282),o=e([n,s]);[n,s]=o.then?(await o)():o;let d=s.createNextApiHandler({router:n.q,createContext:i.k});a()}catch(e){a(e)}})},2688:(e,t,r)=>{r.d(t,{k:()=>n});var a=r(4455),i=r(3227);let n=async({req:e,res:t})=>{let r=await (0,i.getServerSession)(e,t,a.authOptions);return{user:r?.user}}},2357:(e,t,r)=>{r.d(t,{prisma:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},2894:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{F:()=>p});var i=r(46),n=r(2357),s=r(5434),o=r(9926),d=e([i,s,o]);[i,s,o]=d.then?(await d)():d;let p=(0,i.Nd)({findMany:i.Uj.query(async({ctx:{user:e}})=>(await n.prisma.event.findMany({include:{participations:!0}})).map(({participations:t,...r})=>({...r,isJoined:t.some(({userId:t})=>t===e?.id)}))),findUnique:i.Uj.input(o.z.object({id:o.z.number()})).use(i.$D).query(({input:e})=>n.prisma.event.findUnique({where:e,select:{authorId:!0,title:!0,description:!0,date:!0,participations:{select:{user:{select:{name:!0}}}}}})),create:i.Uj.input(s.$z).use(i.$D).mutation(({input:e,ctx:{user:t}})=>n.prisma.event.create({data:{authorId:t.id,...e}})),join:i.Uj.input(s.fx).use(i.$D).mutation(({input:e,ctx:{user:t}})=>n.prisma.participation.create({data:{userId:t.id,eventId:e.id}})),update:i.Uj.input(s.A).use(i.$D).mutation(({input:e})=>n.prisma.event.update({data:{title:e.title,description:e.description,date:e.date},where:{id:e.id}})),leave:i.Uj.input(s.fx).use(i.$D).mutation(({input:e,ctx:{user:t}})=>n.prisma.participation.delete({where:{userId_eventId:{eventId:e.id,userId:t.id}}}))});a()}catch(e){a(e)}})},9326:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{q:()=>o});var i=r(46),n=r(2894),s=e([i,n]);[i,n]=s.then?(await s)():s;let o=(0,i.Nd)({event:n.F});a()}catch(e){a(e)}})},46:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{$D:()=>c,Nd:()=>d,Uj:()=>p});var i=r(2937),n=r(3020),s=e([i,n]);[i,n]=s.then?(await s)():s;let o=i.initTRPC.context().create({transformer:n.default}),d=o.router,p=o.procedure,c=o.middleware(async e=>{let{ctx:t}=e;if(!t.user)throw new i.TRPCError({code:"UNAUTHORIZED"});return e.next({ctx:{user:t.user}})});a()}catch(e){a(e)}})},5434:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{$z:()=>d.$z,A:()=>d.A,fx:()=>d.fx});var i=r(272),n=r(7455),s=r(4936),o=r(3020),d=r(4231),p=e([i,n,s,o,d]);[i,n,s,o,d]=p.then?(await p)():p,(0,n.createTRPCNext)({ssr:!0,ssrPrepass:s.ssrPrepass,config(e){let{ctx:t}=e,r=`http://localhost:${process.env.PORT??3e3}/api/trpc`;return{links:[(0,i.httpBatchLink)({url:r,headers:()=>t?.req?.headers?{cookie:t.req.headers.cookie}:{},transformer:o.default})]}},transformer:o.default}),a()}catch(e){a(e)}})},4231:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{$z:()=>s,A:()=>o,fx:()=>d});var i=r(9926),n=e([i]);let s=(i=(n.then?(await n)():n)[0]).z.object({title:i.z.string().min(1),description:i.z.string().optional(),date:i.z.coerce.date()}),o=i.z.object({id:i.z.number().int().positive(),title:i.z.string().min(1),description:i.z.string().optional(),date:i.z.coerce.date()}),d=i.z.object({id:i.z.number().int().positive()});a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6816);module.exports=r})();